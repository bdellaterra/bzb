#!/bin/bash

# Pull files from each dependency listed in '.deps' (Including nested dependencies)
# NOTE: "bash -c" is used to enable glob expansion
find -L .deps -iname '.deps' -exec bash -c "rsync -Lr --exclude .deps {}\/*/ ." \;

# Setup 'package.json', initializing 'base.package.json' if necessary.
init-package-json

# Setup '.babelrc' if babel configuration is present.
if [[ -d 'conf/babel' ]]; then
    init-babelrc
fi

# Install packages, using 'yarn' if it exists in user's path.
npm=$(which npm)
if [[ ! -x "$npm" ]]; then
    echo "ERROR: Could not find 'npm' executable in path." 1>&2
    exit 1
fi
yarn=$(which yarn)
if [[ -x "$yarn" ]] ; then
    yarn
else
    npm install
fi

